{% extends "layout.html" %} {% block left %}
<div class="rectangle">
  <div class="text-block-content-1">
    <!-- Problem content here -->
    <pre><code>
      {{text_data | safe }}
    </code></pre>
  </div>

  <div id="explanationBlock" class="text-block-content-2">
    <!-- Explanation will be updated here -->
    <hr class="text-block-divider" />
  </div>
</div>
{% endblock %} {% block right %}
<div class="text-block-content-3">
  <iframe
    src="{{ url_for('my_flowchart') }}"
    style="width: 100%; height: 100%; border: none"
  ></iframe>
</div>
{% endblock %} {% block scripts %}
<script>
  // Event listener for messages from the iframe
  window.addEventListener(
    'message',
    function (event) {
      // Handle the node-clicked messages from myflowchart.html
      if (event.data.type === 'node-clicked') {
        // Use the event.data.label as the topic for explanation generation
        var explanationBlock = document.getElementById('explanationBlock');
        explanationBlock.innerHTML = '<div class="spinner"></div>';

        fetch('/explanations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            // If using CSRF protection, add the token here
          },
          body: JSON.stringify({ topic: event.data.label }),
        })
          .then(function (response) {
            return response.json();
          })
          .then(function (data) {
            explanationBlock.innerText = data.explanation;
          })
          .catch(function (error) {
            explanationBlock.innerText = 'An error occurred.';
            console.error('Error:', error);
          });
      }
    },
    false
  );

  // Event listener for the "Process" button
  document.getElementById('processBtn').addEventListener('click', function () {
    // Get the selected text
    var selectedText = window.getSelection().toString();
    if (selectedText) {
      var explanationBlock = document.getElementById('explanationBlock');
      explanationBlock.innerHTML = '<div class="spinner"></div>';

      fetch('/get_explanation', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          // If using CSRF protection, add the token here
        },
        body: JSON.stringify({ selectedText: selectedText }),
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          explanationBlock.innerText = data.explanation;
        })
        .catch(function (error) {
          explanationBlock.innerText = 'An error occurred.';
          console.error('Error:', error);
        });
    } else {
      alert('Please select some text to process.');
    }
  });
</script>
{% endblock %}
